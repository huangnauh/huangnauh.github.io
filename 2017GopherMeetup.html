<!DOCTYPE html>
<!-- saved from url=(0069)http://go-talks.appspot.com/github.com/huangnauh/slides/upone.slide#1 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>基于 mesos 的容器调度框架</title>
    
    <script>
      var notesEnabled =  true ;
    </script>
    <script src="./2017GopherMeetup_files/slides.js"></script><style></style>

    
    <script>
      var sections = [{"Number":[1],"Title":"What's Upone","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/upone.png","Width":1000,"Height":0}],"Notes":null},{"Number":[2],"Title":"Mesos 介绍","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/mesos-logo.png","Width":800,"Height":0},{"Text":"Image credit: [[http://mesos.apache.org/][mesos.apache.org]]"},{"Lines":["官方称之为分布式系统内核, 它把数据中心的 CPU、内存、磁盘等抽象成一个资源池"],"Pre":false}],"Notes":null},{"Number":[3],"Title":"Mesos 调度","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/scheduler.png","Width":800,"Height":0},{"Lines":["各个 Agent 启动后, 向 Master 注册，携带统计资源, 由 Master 决定给每个框架多少资源, 默认采用分级主导资源公平算法"],"Pre":false},{"Lines":["每个框架收到资源后, 根据自身任务需求, 调度任务的资源分配"],"Pre":false}],"Notes":null},{"Number":[4],"Title":"upone","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/marathon_chronos.png","Width":800,"Height":0},{"Lines":["为云处理服务定制的容器调度框架，支持长期服务和定时任务"],"Pre":false}],"Notes":null},{"Number":[5],"Title":"处理流程","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/mesos-seq-diagram.png","Width":800,"Height":0},{"Text":"Image credit: [[https://dcos.io/docs/1.7/overview/architecture/][dcos architecture]]"}],"Notes":null},{"Number":[6],"Title":"消息交互","Elem":[{"Lines":["upone 通过 [[/api/v1/scheduler][/api/v1/scheduler]] 和 mesos master 完成交互"],"Pre":false},{"URL":"https://raw.github.com/huangnauh/slides/master/upone/interface.png","Width":600,"Height":0}],"Notes":null},{"Number":[7],"Title":"订阅","Elem":[{"Lines":["通过 SUBSCRIBE 消息, 开启一个长链接来订阅事件 (Event), 常用事件类型："],"Pre":false},{"URL":"https://raw.github.com/huangnauh/slides/master/upone/event.png","Width":800,"Height":0}],"Notes":null},{"Number":[8],"Title":"OFFERS 事件处理","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/offer.png","Width":600,"Height":0},{"Bullet":["ACCEPT  消息： 接受此 offer， 包括启动任务，预留资源等调度操作","DECLINE 消息： 明确拒绝此 offer","Filter     :  可以设定资源的拒绝时间， 默认是 5s","REVIVE 消息 ： 取消之前设定 filter"]}],"Notes":null},{"Number":[9],"Title":"UPDATE 事件处理","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/state.png","Width":800,"Height":0},{"Text":"Image generated by Mesos web interface"},{"Lines":["状态更新与 upone 的联动, 例如:","- Running 状态, upone 更新负载均衡","- Lost 状态, 任务迁移"],"Pre":false}],"Notes":null},{"Number":[10],"Title":"其他消息","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/message.png","Width":800,"Height":0}],"Notes":null},{"Number":[11],"Title":"More Features","Elem":[{"Lines":["基于以上的 mesos http api, upone 可以实现一个具备基本功能的调度框架"],"Pre":false},{"Lines":["那么除此之外, upone 还可以到哪些"],"Pre":false}],"Notes":null},{"Number":[12],"Title":"特性","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/feature.png","Width":400,"Height":0}],"Notes":null},{"Number":[13],"Title":"负载均衡","Elem":[{"Lines":["基于 *ngx_lua* 的动态负载均衡方案： *Slardar*"],"Pre":false},{"URL":"https://raw.github.com/huangnauh/slides/master/upone/slardar.png","Width":1000,"Height":0}],"Notes":null},{"Number":[14],"Title":"负载均衡","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/balance.png","Width":600,"Height":0},{"Lines":["update slardar:\ncurl 127.0.0.1:1995/upstream/node-dev.example.com -d \\\n{\"servers\":[{\"host\":\"10.0.5.108\", \"port\": 1234}]}"],"Pre":true}],"Notes":null},{"Number":[15],"Title":"零停机更新","Elem":[{"Lines":["通过允许两个不同版本的 *App* 同时运行来实现蓝绿更新"],"Pre":false},{"URL":"https://raw.github.com/huangnauh/slides/master/upone/update.png","Width":600,"Height":0}],"Notes":null},{"Number":[16],"Title":"健康检查","Elem":[{"Lines":["{\n    -- checkups heartbeat timer is alive.\n    \"checkup_timer_alive\": true,\n\n    -- last heartbeat time\n    \"last_check_time\": \"2016-08-12 13:09:40\",\n\n    -- status for node-dev cluster\n    \"cls:node-dev\": [\n        [\n            {\n                \"server\": \"node-dev:10.0.5.108:1234\",\n                \"weight\": 1,\n                \"fail_timeout\": 30,\n                \"status\": \"ok\",\n                \"max_fails\": 6\n            }\n        ]\n    ]\n}"],"Pre":true}],"Notes":null},{"Number":[17],"Title":"预处理","Elem":[{"Lines":["以频率限制为例, 可以在访问 app 前载入 limit 相关脚本完成处理"],"Pre":false},{"Lines":["\"modules\": [\n    {\n        \"time\": \"2017-08-04 13:09:40\",\n        \"version\": \"aed4a968ef14f8db732e3602c34dc37a\",\n        \"name\": \"modules.limit\"\n    },\n    {\n        \"time\": \"2017-08-04 13:09:40\",\n        \"version\": \"302f9bf40fcd3734cab120b97f18edf3\",\n        \"name\": \"script.limit\"\n    }\n]"],"Pre":true}],"Notes":null},{"Number":[18],"Title":"命令行工具","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/upone-cli.png","Width":600,"Height":0},{"Lines":["同时, 我们还提供命令行工具, 以便 App 所有者通过 upone 手动操作上述负载均衡和更新部署的相关功能"],"Pre":false}],"Notes":null},{"Number":[19],"Title":"自定义策略","Elem":[{"Lines":["收到 mesos offer 后, 可以自定义策略来决定任务调度方案"],"Pre":false},{"Bullet":["随机调度"]},{"Lines":["每次调度尽可能让同一应用的各个任务分布到不同机器"],"Pre":false},{"URL":"https://raw.github.com/huangnauh/slides/master/upone/random.png","Width":450,"Height":0}],"Notes":null},{"Number":[20],"Title":"自定义策略","Elem":[{"Bullet":["根据机器和任务的属性进行调度"]},{"URL":"https://raw.github.com/huangnauh/slides/master/upone/attr.png","Width":600,"Height":0}],"Notes":null},{"Number":[21],"Title":"自定义策略","Elem":[{"Bullet":["根据机器 weight/load 动态调度"]},{"URL":"https://raw.github.com/huangnauh/slides/master/upone/load.png","Width":600,"Height":0}],"Notes":null},{"Number":[22],"Title":"配置与服务发现","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/consul.png","Width":600,"Height":0},{"Bullet":["upone 动态加载属性","注册服务","应用配置统一管理"]}],"Notes":null},{"Number":[23],"Title":"高可用","Elem":[{"Lines":["通过 *Raft* 分布式一致性协议实现高可用"],"Pre":false},{"Lines":["[[https://github.com/hashicorp/raft][hashicorp/raft]]"],"Pre":false},{"Bullet":["领导选举: 心跳机制来触发选举, term 充当逻辑时钟的作用","日志复制: 领导者把一条指令(能被复制状态机执行)附加到日志中，发起附加条目 RPC 请求给其他角色","强领导者：日志条目只从 leader 发送给其他的服务器"]}],"Notes":null},{"Number":[24],"Title":"raft 领导选举","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/raft-leader.png","Width":0,"Height":0},{"Text":"Image credit: [[https://raft.github.io/raft.pdf][the Raft paper]]"}],"Notes":null},{"Number":[25],"Title":"raft 日志复制","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/raft-log.png","Width":650,"Height":0},{"Text":"Image credit: [[https://raft.github.io/raft.pdf][the Raft paper]]"}],"Notes":null},{"Number":[26],"Title":"raft 可视化","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/raft.gif","Width":0,"Height":0},{"Text":"Image generated by [[https://raft.github.io/raftscope/index.html][RaftScope]]"}],"Notes":null},{"Number":[27],"Title":"upone 定时任务","Elem":[{"Lines":["[[https://github.com/mesos/chronos][mesos/chronos]] 很多遗留问题没有解决"],"Pre":false},{"Lines":["不再维护:"],"Pre":false},{"Bullet":["is:issue is:open 188","Latest commit on 1 Mar"]},{"Lines":["遇到的问题:"],"Pre":false},{"Bullet":["cpu 利用率达到 100%","共享数据缺乏锁保护"]}],"Notes":null},{"Number":[28],"Title":"定时任务特性","Elem":[{"Bullet":["支持 upone 的上述特性(自定义调度等)","支持 linux 定时任务 crontab 的配置格式"]},{"URL":"https://raw.github.com/huangnauh/slides/master/upone/crontab.jpg","Width":600,"Height":0}],"Notes":null},{"Number":[29],"Title":"组件化","Elem":[{"Bullet":["store 组件, 已支持 [[https://github.com/hashicorp/raft-boltdb][hashicorp/raft-boltdb]], 数据库","drive 组件, upone 可以选择 master-agent 模式, 不依赖于 mesos 独立使用"]}],"Notes":null},{"Number":[30],"Title":"告警","Elem":[{"Lines":["各个应用可以在创建任务的时候指定自己的 slack channel"],"Pre":false},{"Lines":["当任务出现异常时, 发送实时通知"],"Pre":false},{"URL":"https://raw.github.com/huangnauh/slides/master/upone/slack.png","Width":700,"Height":0}],"Notes":null},{"Number":[31],"Title":"告警","Elem":[{"URL":"https://raw.github.com/huangnauh/slides/master/upone/alarm.png","Width":700,"Height":0}],"Notes":null},{"Number":[32],"Title":"遇到的问题","Elem":[{"Bullet":["孤儿任务"]},{"Lines":["mesos 上未注册的 framework 没有办法 teardown","只能等 failover_timeout, 或者再次注册同一 id, 主动删除","最近发现 failover_timeout 之后, mesos 上的孤儿任务依然保留着"],"Pre":false},{"Bullet":["tcp_tw_recycle"]},{"Lines":["在请求不能保证时间戳单调递增的情况下(比如 NAT) 会出现丢包"],"Pre":false}],"Notes":null},{"Number":[33],"Title":"References","Elem":[{"Bullet":["docs"]},{"Lines":["[1] [[http://mesos.apache.org/documentation/latest/scheduler-http-api/][scheduler-http-api]]","[2] [[http://mesos.berkeley.edu/mesos_tech_report.pdf][mesos tech report]]","[3] [[https://raft.github.io/raft.pdf][the Raft paper]]","[4] [[https://raft.github.io/raftscope/index.html][RaftScope]]"],"Pre":false},{"Bullet":["projects"]},{"Lines":["[1] [[https://github.com/apache/mesos][apache/mesos]]","[2] [[https://github.com/upyun/slardar][upyun/slardar]]","[3] [[https://github.com/hashicorp/consul][hashicorp/consul]]","[4] [[https://github.com/hashicorp/raft][hashicorp/raft]]","[5] [[https://github.com/mesos/chronos][mesos/chronos]]","[6] [[https://github.com/mesosphere/marathon][mesosphere/marathon]]"],"Pre":false}],"Notes":null}];
      var titleNotes =  null 
    </script>
    <script src="./2017GopherMeetup_files/notes.js"></script>
    

    <script>
      
      if (window["location"] && window["location"]["hostname"] == "talks.golang.org") {
        var _gaq = _gaq || [];
        _gaq.push(["_setAccount", "UA-11222381-6"]);
        _gaq.push(["b._setAccount", "UA-49880327-6"]);
        window.trackPageview = function() {
          _gaq.push(["_trackPageview", location.pathname+location.hash]);
          _gaq.push(["b._trackPageview", location.pathname+location.hash]);
        };
        window.trackPageview();
        window.trackEvent = function(category, action, opt_label, opt_value, opt_noninteraction) {
          _gaq.push(["_trackEvent", category, action, opt_label, opt_value, opt_noninteraction]);
          _gaq.push(["b._trackEvent", category, action, opt_label, opt_value, opt_noninteraction]);
        };
      }
    </script>
  <meta name="viewport" content="width=1100,height=750"><meta name="apple-mobile-web-app-capable" content="yes"><style id="style-1-cropbar-clipper">/* Copyright 2014 Evernote Corporation. All rights reserved. */
.en-markup-crop-options {
    top: 18px !important;
    left: 50% !important;
    margin-left: -100px !important;
    width: 200px !important;
    border: 2px rgba(255,255,255,.38) solid !important;
    border-radius: 4px !important;
}

.en-markup-crop-options div div:first-of-type {
    margin-left: 0px !important;
}
</style></head>

  <body style="display: none" class="loaded" data-feedly-mini="yes">

    <section class="slides layout-widescreen">

      <article class="current">
        <h1>基于 mesos 的容器调度框架</h1>
        <h3>Gopher 杭州 meetup</h3>
        <h3>5 August 2017</h3>
        
          <div class="presenter">
            
  
  <p>
    黄励博(huangnauh)
  </p>
  

  
  <p>
    又拍云
  </p>
  

          </div>
        
          <div class="presenter">
            
  
  <p>
    
  </p>
  

          </div>
        
          <div class="presenter">
            
  
  <p>
    
  </p>
  

          </div>
        
      </article>

  
  
      <article class="next">
      
        <h3>What's Upone</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/upone.png" width="1000">
</div>

      
      </article>
  
  
  
      <article class="far-next">
      
        <h3>Mesos 介绍</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/mesos-logo.png" width="800">
</div>
<figcaption>Image credit: <a href="http://mesos.apache.org/" target="_blank">mesos.apache.org</a></figcaption>
  
  <p>
    官方称之为分布式系统内核, 它把数据中心的 CPU、内存、磁盘等抽象成一个资源池
  </p>
  

      
      </article>
  
  
  
      <article>
      
        <h3>Mesos 调度</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/scheduler.png" width="800">
</div>

  
  <p>
    各个 Agent 启动后, 向 Master 注册，携带统计资源, 由 Master 决定给每个框架多少资源, 默认采用分级主导资源公平算法
  </p>
  

  
  <p>
    每个框架收到资源后, 根据自身任务需求, 调度任务的资源分配
  </p>
  

      
      </article>
  
  
  
      <article>
      
        <h3>upone</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/marathon_chronos.png" width="800">
</div>

  
  <p>
    为云处理服务定制的容器调度框架，支持长期服务和定时任务
  </p>
  

      
      </article>
  
  
  
      <article>
      
        <h3>处理流程</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/mesos-seq-diagram.png" width="800">
</div>
<figcaption>Image credit: <a href="https://dcos.io/docs/1.7/overview/architecture/" target="_blank">dcos architecture</a></figcaption>
      
      </article>
  
  
  
      <article>
      
        <h3>消息交互</h3>
        
  
  <p>
    upone 通过 <a href="http://go-talks.appspot.com/api/v1/scheduler" target="_self">/api/v1/scheduler</a> 和 mesos master 完成交互
  </p>
  

<div class="image">
  <img src="./2017GopherMeetup_files/interface.png" width="600">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>订阅</h3>
        
  
  <p>
    通过 SUBSCRIBE 消息, 开启一个长链接来订阅事件 (Event), 常用事件类型：
  </p>
  

<div class="image">
  <img src="./2017GopherMeetup_files/event.png" width="800">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>OFFERS 事件处理</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/offer.png" width="600">
</div>

  <ul>
  
    <li>ACCEPT  消息： 接受此 offer， 包括启动任务，预留资源等调度操作</li>
  
    <li>DECLINE 消息： 明确拒绝此 offer</li>
  
    <li>Filter     :  可以设定资源的拒绝时间， 默认是 5s</li>
  
    <li>REVIVE 消息 ： 取消之前设定 filter</li>
  
  </ul>

      
      </article>
  
  
  
      <article>
      
        <h3>UPDATE 事件处理</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/state.png" width="800">
</div>
<figcaption>Image generated by Mesos web interface</figcaption>
  
  <p>
    状态更新与 upone 的联动, 例如:
<br>

    - Running 状态, upone 更新负载均衡
<br>

    - Lost 状态, 任务迁移
  </p>
  

      
      </article>
  
  
  
      <article>
      
        <h3>其他消息</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/message.png" width="800">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>More Features</h3>
        
  
  <p>
    基于以上的 mesos http api, upone 可以实现一个具备基本功能的调度框架
  </p>
  

  
  <p>
    那么除此之外, upone 还可以到哪些
  </p>
  

      
      </article>
  
  
  
      <article>
      
        <h3>特性</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/feature.png" width="400">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>负载均衡</h3>
        
  
  <p>
    基于 <b>ngx_lua</b> 的动态负载均衡方案： <b>Slardar</b>
  </p>
  

<div class="image">
  <img src="./2017GopherMeetup_files/slardar.png" width="1000">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>负载均衡</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/balance.png" width="600">
</div>

  
  <div class="code"><pre>update slardar:
curl 127.0.0.1:1995/upstream/node-dev.example.com -d \
{"servers":[{"host":"10.0.5.108", "port": 1234}]}</pre></div>
  

      
      </article>
  
  
  
      <article>
      
        <h3>零停机更新</h3>
        
  
  <p>
    通过允许两个不同版本的 <b>App</b> 同时运行来实现蓝绿更新
  </p>
  

<div class="image">
  <img src="./2017GopherMeetup_files/update.png" width="600">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>健康检查</h3>
        
  
  <div class="code"><pre>{
    -- checkups heartbeat timer is alive.
    "checkup_timer_alive": true,

    -- last heartbeat time
    "last_check_time": "2016-08-12 13:09:40",

    -- status for node-dev cluster
    "cls:node-dev": [
        [
            {
                "server": "node-dev:10.0.5.108:1234",
                "weight": 1,
                "fail_timeout": 30,
                "status": "ok",
                "max_fails": 6
            }
        ]
    ]
}</pre></div>
  

      
      </article>
  
  
  
      <article>
      
        <h3>预处理</h3>
        
  
  <p>
    以频率限制为例, 可以在访问 app 前载入 limit 相关脚本完成处理
  </p>
  

  
  <div class="code"><pre>"modules": [
    {
        "time": "2017-08-04 13:09:40",
        "version": "aed4a968ef14f8db732e3602c34dc37a",
        "name": "modules.limit"
    },
    {
        "time": "2017-08-04 13:09:40",
        "version": "302f9bf40fcd3734cab120b97f18edf3",
        "name": "script.limit"
    }
]</pre></div>
  

      
      </article>
  
  
  
      <article>
      
        <h3>命令行工具</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/upone-cli.png" width="600">
</div>

  
  <p>
    同时, 我们还提供命令行工具, 以便 App 所有者通过 upone 手动操作上述负载均衡和更新部署的相关功能
  </p>
  

      
      </article>
  
  
  
      <article>
      
        <h3>自定义策略</h3>
        
  
  <p>
    收到 mesos offer 后, 可以自定义策略来决定任务调度方案
  </p>
  

  <ul>
  
    <li>随机调度</li>
  
  </ul>

  
  <p>
    每次调度尽可能让同一应用的各个任务分布到不同机器
  </p>
  

<div class="image">
  <img src="./2017GopherMeetup_files/random.png" width="450">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>自定义策略</h3>
        
  <ul>
  
    <li>根据机器和任务的属性进行调度</li>
  
  </ul>

<div class="image">
  <img src="./2017GopherMeetup_files/attr.png" width="600">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>自定义策略</h3>
        
  <ul>
  
    <li>根据机器 weight/load 动态调度</li>
  
  </ul>

<div class="image">
  <img src="./2017GopherMeetup_files/load.png" width="600">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>配置与服务发现</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/consul.png" width="600">
</div>

  <ul>
  
    <li>upone 动态加载属性</li>
  
    <li>注册服务</li>
  
    <li>应用配置统一管理</li>
  
  </ul>

      
      </article>
  
  
  
      <article>
      
        <h3>高可用</h3>
        
  
  <p>
    通过 <b>Raft</b> 分布式一致性协议实现高可用
  </p>
  

  
  <p>
    <a href="https://github.com/hashicorp/raft" target="_blank">hashicorp/raft</a>
  </p>
  

  <ul>
  
    <li>领导选举: 心跳机制来触发选举, term 充当逻辑时钟的作用</li>
  
    <li>日志复制: 领导者把一条指令(能被复制状态机执行)附加到日志中，发起附加条目 RPC 请求给其他角色</li>
  
    <li>强领导者：日志条目只从 leader 发送给其他的服务器</li>
  
  </ul>

      
      </article>
  
  
  
      <article>
      
        <h3>raft 领导选举</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/raft-leader.png">
</div>
<figcaption>Image credit: <a href="https://raft.github.io/raft.pdf" target="_blank">the Raft paper</a></figcaption>
      
      </article>
  
  
  
      <article>
      
        <h3>raft 日志复制</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/raft-log.png" width="650">
</div>
<figcaption>Image credit: <a href="https://raft.github.io/raft.pdf" target="_blank">the Raft paper</a></figcaption>
      
      </article>
  
  
  
      <article>
      
        <h3>raft 可视化</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/raft.gif">
</div>
<figcaption>Image generated by <a href="https://raft.github.io/raftscope/index.html" target="_blank">RaftScope</a></figcaption>
      
      </article>
  
  
  
      <article>
      
        <h3>upone 定时任务</h3>
        
  
  <p>
    <a href="https://github.com/mesos/chronos" target="_blank">mesos/chronos</a> 很多遗留问题没有解决
  </p>
  

  
  <p>
    不再维护:
  </p>
  

  <ul>
  
    <li>is:issue is:open 188</li>
  
    <li>Latest commit on 1 Mar</li>
  
  </ul>

  
  <p>
    遇到的问题:
  </p>
  

  <ul>
  
    <li>cpu 利用率达到 100%</li>
  
    <li>共享数据缺乏锁保护</li>
  
  </ul>

      
      </article>
  
  
  
      <article>
      
        <h3>定时任务特性</h3>
        
  <ul>
  
    <li>支持 upone 的上述特性(自定义调度等)</li>
  
    <li>支持 linux 定时任务 crontab 的配置格式</li>
  
  </ul>

<div class="image">
  <img src="./2017GopherMeetup_files/crontab.jpg" width="600">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>组件化</h3>
        
  <ul>
  
    <li>store 组件, 已支持 <a href="https://github.com/hashicorp/raft-boltdb" target="_blank">hashicorp/raft-boltdb</a>, 数据库</li>
  
    <li>drive 组件, upone 可以选择 master-agent 模式, 不依赖于 mesos 独立使用</li>
  
  </ul>

      
      </article>
  
  
  
      <article>
      
        <h3>告警</h3>
        
  
  <p>
    各个应用可以在创建任务的时候指定自己的 slack channel
  </p>
  

  
  <p>
    当任务出现异常时, 发送实时通知
  </p>
  

<div class="image">
  <img src="./2017GopherMeetup_files/slack.png" width="700">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>告警</h3>
        
<div class="image">
  <img src="./2017GopherMeetup_files/alarm.png" width="700">
</div>

      
      </article>
  
  
  
      <article>
      
        <h3>遇到的问题</h3>
        
  <ul>
  
    <li>孤儿任务</li>
  
  </ul>

  
  <p>
    mesos 上未注册的 framework 没有办法 teardown
<br>

    只能等 failover_timeout, 或者再次注册同一 id, 主动删除
<br>

    最近发现 failover_timeout 之后, mesos 上的孤儿任务依然保留着
  </p>
  

  <ul>
  
    <li>tcp_tw_recycle</li>
  
  </ul>

  
  <p>
    在请求不能保证时间戳单调递增的情况下(比如 NAT) 会出现丢包
  </p>
  

      
      </article>
  
  
  
      <article>
      
        <h3>References</h3>
        
  <ul>
  
    <li>docs</li>
  
  </ul>

  
  <p>
    [1] <a href="http://mesos.apache.org/documentation/latest/scheduler-http-api/" target="_blank">scheduler-http-api</a>
<br>

    [2] <a href="http://mesos.berkeley.edu/mesos_tech_report.pdf" target="_blank">mesos tech report</a>
<br>

    [3] <a href="https://raft.github.io/raft.pdf" target="_blank">the Raft paper</a>
<br>

    [4] <a href="https://raft.github.io/raftscope/index.html" target="_blank">RaftScope</a>
  </p>
  

  <ul>
  
    <li>projects</li>
  
  </ul>

  
  <p>
    [1] <a href="https://github.com/apache/mesos" target="_blank">apache/mesos</a>
<br>

    [2] <a href="https://github.com/upyun/slardar" target="_blank">upyun/slardar</a>
<br>

    [3] <a href="https://github.com/hashicorp/consul" target="_blank">hashicorp/consul</a>
<br>

    [4] <a href="https://github.com/hashicorp/raft" target="_blank">hashicorp/raft</a>
<br>

    [5] <a href="https://github.com/mesos/chronos" target="_blank">mesos/chronos</a>
<br>

    [6] <a href="https://github.com/mesosphere/marathon" target="_blank">mesosphere/marathon</a>
  </p>
  

      
      </article>
  
  

      <article>
        <h3>Thank you</h3>
        
          <div class="presenter">
            
  
  <p>
    黄励博(huangnauh)
  </p>
  

  
  <p>
    又拍云
  </p>
  
<p class="link"><a href="mailto:ihuangnauh@gmail.com" target="_blank">ihuangnauh@gmail.com</a></p><p class="link"><a href="https://github.com/huangnauh" target="_blank">https://github.com/huangnauh</a></p>
          </div>
        
          <div class="presenter">
            
  
  <p>
    
  </p>
  

          </div>
        
          <div class="presenter">
            
  
  <p>
    
  </p>
  

          </div>
        
      </article>

    <div class="slide-area" id="prev-slide-area"></div><div class="slide-area" id="next-slide-area"></div></section>

    <div id="help">
      Use the left and right arrow keys or click the left and right
      edges of the page to navigate between slides.<br>
      (Press 'H' or navigate to hide this message.)
    </div>

    
    <script src="./2017GopherMeetup_files/play.js"></script>
    

    <script>
      (function() {
        
        if (window["location"] && window["location"]["hostname"] == "talks.golang.org") {
          var ga = document.createElement("script"); ga.type = "text/javascript"; ga.async = true;
          ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
          var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(ga, s);
        }
      })();
    </script>
  

<link rel="stylesheet" type="text/css" href="./2017GopherMeetup_files/css"><link rel="stylesheet" type="text/css" href="./2017GopherMeetup_files/styles.css"><div id="feedly-mini" title="feedly Mini tookit"></div></body></html>